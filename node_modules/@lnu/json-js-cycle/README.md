# @lnu/json-js-cycle

This package provides essential functionality for encoding and decoding data structures with circular references in JSON. It is based on the `cycle.cs` file from Douglas Crockford's JSON-js repository <https://github.com/douglascrockford/JSON-js>.

## Installation

```bash
npm install @lnu/json-js-cycle
```

## Usage

```javascript
import '@lnu/json-js-cycle'
```

### JSON.decycle(value, options)

Make a deep copy of an object or array, assuring that there is at most one instance of each object or array in the resulting structure. The duplicate references (which might be forming cycles) are replaced with an object. The property names are sorted.

#### Options

`includeNonEnumerableProperties` - If set to `true`, non-enumerable properties will be included in the result. By default, the `includeNonEnumerableProperties` attribute is set to `false`.

`replacer` - A function that transforms values. The function is called for each item and should return the value to be used instead of the original value. If the original value is to be used, the function should return the value it received. By default, the `replacer` attribute is not set.

#### Examples

The duplicate references (which might be forming cycles) are replaced with an object of the form `{"$ref": PATH}`, where the PATH is a JSONPath string that identifies the first occurrence.

```javascript
// The example below is taken from the original cycle.js file.

const a = []
a[0] = a
console.log(JSON.stringify(JSON.decycle(a)))
// output: [{"$ref":"$"}]
```

By default, the `decycle` function excludes non-enumerable properties. However, if you set the `includeNonEnumerableProperties` option to `true`, it will include these properties in the result.

```javascript
const error = new Error('Something went really wrong.')
error.status = 500

console.log(JSON.stringify(
    JSON.decycle(error))
)
// output: {"status":500}

console.log(JSON.stringify(
    JSON.decycle(error, { includeNonEnumerableProperties: true }))
)
// output: {"message":"Something went really wrong.","stack":"Error: Something went really wrong.\n    at file:[Omitted for clarity]","status":500}

```

> ## README from JSON-js
>
> _NOTE! The information about json2.js is striked through because it is not used in this package._
>
>JSON in JavaScript
>
>
>Douglas Crockford
><douglas@crockford.com>
>
>2019-08-25
>
>JSON is a light-weight, language independent, data interchange format.
>See <http://www.JSON.org/>
>
>JSON became a built-in feature of JavaScript when the ECMAScript Programming
Language Standard - Fifth Edition was adopted by the ECMA General Assembly
in December 2009.
>
>~~json2.js: This file creates a JSON property in the global object, if there
isn't already one, setting its value to an object containing a stringify
method and a parse method. The parse method uses the eval method to do the
parsing, guarding it with several regular expressions to defend against
accidental code execution hazards. On current browsers, this file does nothing,
preferring the built-in JSON object. There is no reason to use this file unless
fate compels you to support IE8, which is something that no one should ever
have to do again.~~
>
>cycle.js: This file contains two functions, JSON.decycle and JSON.retrocycle,
which make it possible to encode cyclical structures and dags in JSON, and to
then recover them. This is a capability that is not provided by ES5. JSONPath
is used to represent the links. <http://GOESSNER.net/articles/JsonPath/>
